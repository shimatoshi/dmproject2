# dmonline2

**React + Firebaseで構築された、モバイルファーストなトレーディングカードゲーム(TCG)対戦プラットフォーム**

[デモアプリはこちら (Live Demo)](https://dmonline-20f98.web.app/)

##  概要
個人的にプレイしているTCGの対戦を、場所を選ばずオンラインで行うために開発したSPA（Single Page Application）です。
既存のシミュレーターはPC向けが多く、スマホでの操作性が低いという課題がありました。本プロジェクトでは**「スマートフォンでの快適なプレイ体験」**を最優先に設計し、タップ操作主体のUI/UXを実現しました。

デッキ構築から対戦（ルームマッチ）、チャット機能まで、TCGに必要な一連の機能をワンストップで提供します。

## 使用技術

### フロントエンド
* **Core:** React 18, Vite
* **Routing:** React Router DOM v6
* **State Management:** React Hooks (Context API, Custom Hooks)
* **Styling:** CSS Modules (Dark Mode base)
* **Utils:** html2canvas (デッキ画像出力)

### バックエンド / インフラ (Firebase)
* **Authentication:** Firebase Auth (メール/パスワード認証, 匿名認証)
* **Database:** Cloud Firestore (NoSQL, リアルタイムリスナー)
* **Hosting:** Firebase Hosting

### 開発環境
* **Environment:** Termux on Android (モバイル環境のみでのフルスタック開発)

##  主な機能

### 1. リアルタイム対戦機能
Firestoreの `onSnapshot` を活用し、低遅延での盤面同期を実現しました。
* **ゾーン管理:** 手札、山札、マナ、シールド、墓地、バトルゾーン、一時公開ゾーンの7領域を管理。
* **カード操作:** タップ（アンタップ）、裏向き表示、進化（カードの重ね合わせ）、シールドブレイク等の複雑な処理を実装。
* **同期:** 相手の操作（ドロー、マナチャージ、攻撃など）が即座に自分の画面に反映。

### 2. デッキ構築 & 図鑑管理
* **カード登録:** ユーザー独自のカードデータベースを作成可能（画像URL、文明、コスト、タグ管理）。
* **デッキ編成:** グリッド表示による直感的なデッキ構築。
* **データ互換:** JSON形式でのインポート/エクスポート機能により、ユーザー間でのデータ共有やバックアップが可能。

### 3. ロビー & マッチング
* **ルーム作成:** ホストが部屋を作成し、ゲストが入室するルームマッチ形式。
* **状態監視:** 募集中/対戦中のステータス管理と、進行中の対戦への再接続機能。
* **チャット:** 対戦中のコミュニケーション機能。

##  こだわったポイント・技術的工夫

###  スマホ特化のUI/UX設計 (Touch Interaction)
PCのようなドラッグ&ドロップ操作はスマホでは誤操作の原因となるため、あえて採用せず**「タップ選択 → 移動先タップ」**というステートマシン的な操作体系を構築しました。
* **アクションメニュー:** カード選択時に、そのゾーンで実行可能なアクション（マナ送り、バトルに出す等）のみを動的に表示。
* **視認性の確保:** 狭い画面でも盤面全体を把握できるよう、ゾーンの配置やカードの重なり表示をCSSで細かく調整。

###  複雑なカード状態のデータモデリング
TCG特有の「カードの状態」をFirestore上で効率的に管理するため、データ構造を工夫しました。
* 単なる画像URLの配列ではなく、`{ url, isTapped, isFaceDown, stack: [], id }` というオブジェクト構造を採用。
* **進化/Complex:** 複数のカードが重なる「スタック（束）」構造を再帰的に持たせることで、進化クリーチャーや特殊なカードの挙動に対応。
* **非公開領域:** 相手の手札やシールドは「枚数」のみを同期し、中身のデータはセキュアに管理（または裏面画像としてレンダリング）。

###  Firestoreの書き込み最適化
頻繁な盤面更新によるコストとラグを抑えるため、変更があった差分データのみをマージする設計にしています。また、`useEffect` の依存配列を適切に管理し、不要な再レンダリングや通信を防いでいます。

##  今後の展望
* **自動処理の導入:** 現在はサンドボックス（手動操作）型ですが、マナコスト計算やターン処理の自動化を検討中。
* **SE/エフェクト:** 操作感を高めるためのサウンドとアニメーションの実装。

---
*Created by Toshiyuki Shimada*
